<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${recipe.title} + ' - MasakCuyy'"></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <h1>MasakCuyy</h1>
        <div>
            <a th:href="@{/}">Explore</a>
            <span sec:authorize="isAuthenticated()">
                <a th:href="@{/my-recipes}">My Recipes</a>
                <a th:href="@{/my-favorites}">My Favorites</a>
                <span class="user-info" th:text="'Hello, ' + ${user?.username} + '!'" th:if="${user}"></span>
                <form th:action="@{/logout}" method="post" class="logout-form">
                    <button type="submit" class="logout-button">Logout</button>
                </form>
            </span>
            <span sec:authorize="!isAuthenticated()">
                <a th:href="@{/login}">Login</a>
                <a th:href="@{/register}">Register</a>
            </span>
        </div>
    </div>

    <!-- Content Area -->
    <div class="content-area">
        <!-- Recipe Header -->
        <div class="recipe-header">
            <h1 th:text="${recipe.title}">Recipe Title</h1>
            <p class="recipe-meta">
                Created by: <span th:text="${recipe.user.username}"></span> on
                <span th:text="${#temporals.format(recipe.publishDate, 'dd MMMM yyyy HH:mm')}"></span>
            </p>
        </div>

        <!-- Recipe Image -->
        <div th:if="${recipe.imageUrl}" style="text-align: center; margin-bottom: 20px;">
            <img th:src="${recipe.imageUrl}" alt="Recipe Image" class="recipe-image">
        </div>

        <!-- Recipe Sections -->
        <div class="recipe-section">
            <h2>Description</h2>
            <p th:if="${recipe.description}" class="recipe-description" th:text="${recipe.description}"></p>
            <p th:unless="${recipe.description}" class="recipe-description">No description provided.</p>
        </div>

        <div class="recipe-section">
            <h2>Ingredients</h2>
            <ul th:if="${recipe.ingredients != null and !recipe.ingredients.isEmpty()}">
                <li th:each="ingredient : ${#strings.arraySplit(recipe.ingredients, '\n')}" th:text="${ingredient.trim()}"></li>
            </ul>
            <p th:if="${recipe.ingredients == null or recipe.ingredients.isEmpty()}">No ingredients listed.</p>
        </div>

        <div class="recipe-section">
            <h2>Instructions</h2>
            <ol th:if="${recipe.instructions != null and !recipe.instructions.isEmpty()}">
                <li th:each="instruction : ${#strings.arraySplit(recipe.instructions, '\n')}" th:text="${instruction.trim()}"></li>
            </ol>
            <p th:if="${recipe.instructions == null or recipe.instructions.isEmpty()}">No instructions provided.</p>
        </div>

        <!-- Recipe Actions -->
        <div th:unless="${isOwner}" sec:authorize="isAuthenticated()" class="recipe-actions-detail">
            <form th:action="@{/recipes/{id}/toggle-favorite(id=${recipe.id})}" method="post">
                <button type="submit" th:classappend="${isFavorited ? 'remove-favorite-button' : 'favorite-button'}">
                    <span th:text="${isFavorited ? 'Remove from Favorites' : 'Add to Favorites'}">Add to Favorites</span>
                </button>
            </form>
        </div>

        <div th:if="${isOwner}" class="recipe-actions-detail">
            <a th:href="@{/my-recipes/edit/{id}(id=${recipe.id})}" class="edit-button">Edit Recipe</a>
            <form th:action="@{/my-recipes/delete/{id}(id=${recipe.id})}" method="post" style="display: inline;">
                <button type="submit" class="delete-button" onclick="return confirm('Are you sure you want to delete this recipe?');">Delete Recipe</button>
            </form>
        </div>

        <!-- Back Link -->
        <div class="back-link">
            <a sec:authorize="isAuthenticated()" href="/my-recipes">Back to My Recipes</a>
            <a sec:authorize="isAnonymous()" href="/">Back
