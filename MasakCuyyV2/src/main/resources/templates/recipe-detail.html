<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Detail resep masakan di MasakCuyy - platform berbagi resep masakan Indonesia">
    <title th:text="${recipe.title} + ' - MasakCuyy'">Recipe - MasakCuyy</title>
    <link rel="stylesheet" href="/css/style.css">
    <meta property="og:title" th:content="${recipe.title} + ' - MasakCuyy'">
    <meta property="og:description" th:content="${recipe.description}">
    <meta property="og:image" th:content="${recipe.imageUrl}">
    <meta property="og:type" content="article">
</head>
<body>
    <header class="header">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="navbar-brand">
                <h1><a href="/" th:href="@{/}">MasakCuyy</a></h1>
            </div>
            <div class="navbar-menu">
                <div sec:authorize="isAuthenticated()" class="authenticated-menu">
                    <span class="user-info" th:text="'Halo, ' + ${user?.username} + '!'" th:if="${user}" aria-label="User greeting"></span>
                    <form th:action="@{/logout}" method="post" class="logout-form">
                        <button type="submit" class="logout-button" aria-label="Logout from account">Logout</button>
                    </form>
                </div>
                <div sec:authorize="!isAuthenticated()" class="guest-menu">
                    <a th:href="@{/login}" class="nav-link">Login</a>
                    <a th:href="@{/register}" class="nav-link">Register</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="main-wrapper">
        <aside class="sidebar" role="navigation" aria-label="Secondary navigation">
            <nav class="sidebar-nav">
                <a th:href="@{/}" class="sidebar-link active" aria-current="page">
                    <span class="sidebar-icon">üè†</span>
                    Jelajahi
                </a>
                <div sec:authorize="isAuthenticated()" class="authenticated-sidebar">
                    <a th:href="@{/my-recipes}" class="sidebar-link">
                        <span class="sidebar-icon">üìñ</span>
                        Resep Saya
                    </a>
                    <a th:href="@{/my-favorites}" class="sidebar-link">
                        <span class="sidebar-icon">‚ù§Ô∏è</span>
                        Favorit Saya
                    </a>
                </div>
            </nav>
        </aside>

        <main class="main-content-wrapper" role="main">
            <article class="content-area recipe-detail-area">
                <header class="recipe-header">
                    <h1 th:text="${recipe.title}" class="recipe-title">Recipe Title</h1>
                    <div class="recipe-meta">
                        <p class="recipe-author">
                            <span class="meta-label">Dibuat oleh:</span> 
                            <strong th:text="${recipe.user.username}">Author</strong>
                        </p>
                        <p class="recipe-date">
                            <span class="meta-label">Dipublikasi:</span>
                            <time th:datetime="${recipe.publishDate}" 
                                  th:text="${#temporals.format(recipe.publishDate, 'dd MMMM yyyy HH:mm')}">
                                Date
                            </time>
                        </p>
                    </div>
                </header>

                <figure th:if="${recipe.imageUrl}" class="recipe-image-container">
                    <img th:src="${recipe.imageUrl}" 
                         th:alt="'Gambar resep ' + ${recipe.title}" 
                         class="recipe-image-detail"
                         loading="lazy">
                    <figcaption class="sr-only" th:text="'Foto dari resep ' + ${recipe.title}"></figcaption>
                </figure>

                <section class="recipe-section" aria-labelledby="description-heading">
                    <h2 id="description-heading">Deskripsi</h2>
                    <div class="recipe-description">
                        <p th:if="${recipe.description}" th:text="${recipe.description}">Description content</p>
                        <p th:unless="${recipe.description}" class="no-content-text">
                            <em>Tidak ada deskripsi yang tersedia.</em>
                        </p>
                    </div>
                </section>

                <section class="recipe-section" aria-labelledby="ingredients-heading">
                    <h2 id="ingredients-heading">Bahan-bahan</h2>
                    <div class="ingredients-container">
                        <pre class="recipe-pre-format" 
                             th:if="${!#strings.isEmpty(recipe.ingredients)}" 
                             th:text="${recipe.ingredients}"></pre>
                        <p th:if="${recipe.ingredients == null or #strings.isEmpty(recipe.ingredients)}" 
                           class="no-content-text">
                            <em>Tidak ada bahan yang tercantum.</em>
                        </p>
                    </div>
                </section>

                <section class="recipe-section" aria-labelledby="instructions-heading">
                    <h2 id="instructions-heading">Cara Memasak</h2>
                    <div class="instructions-container">
                        <pre class="recipe-pre-format" 
                             th:if="${!#strings.isEmpty(recipe.instructions)}" 
                             th:text="${recipe.instructions}"></pre>
                        <p th:if="${recipe.instructions == null or #strings.isEmpty(recipe.instructions)}" 
                           class="no-content-text">
                            <em>Tidak ada instruksi yang tersedia.</em>
                        </p>
                    </div>
                </section>

                <section class="recipe-actions-detail" aria-label="Recipe actions">
                    <div th:unless="${isOwner}" sec:authorize="isAuthenticated()" class="favorite-section">
                        <form th:action="@{/recipes/{id}/toggle-favorite(id=${recipe.id})}" method="post">
                            <button type="submit" 
                                    th:classappend="${isFavorited ? 'remove-favorite-button' : 'favorite-button'}"
                                    th:attr="aria-label=${isFavorited ? 'Hapus dari favorit' : 'Tambah ke favorit'}">
                                <span class="button-icon" th:text="${isFavorited ? 'üíî' : '‚ù§Ô∏è'}">‚ù§Ô∏è</span>
                                <span th:text="${isFavorited ? 'Hapus dari Favorit' : 'Tambah ke Favorit'}">Add to Favorites</span>
                            </button>
                        </form>
                    </div>

                    <div th:if="${isOwner}" class="owner-actions">
                        <a th:href="@{/my-recipes/edit/{id}(id=${recipe.id})}" 
                           class="edit-button"
                           aria-label="Edit this recipe">
                            <span class="button-icon">‚úèÔ∏è</span>
                            Edit Resep
                        </a>
                        <form th:action="@{/my-recipes/delete/{id}(id=${recipe.id})}" 
                              method="post" 
                              class="delete-form"
                              onsubmit="return confirm('Apakah Anda yakin ingin menghapus resep ini?');">
                            <button type="submit" 
                                    class="delete-button"
                                    aria-label="Delete this recipe">
                                <span class="button-icon">üóëÔ∏è</span>
                                Hapus Resep
                            </button>
                        </form>
                    </div>
                </section>

                <nav class="back-navigation" aria-label="Back navigation">
                    <a th:href="@{${isOwner ? '/my-recipes' : '/'}}" 
                       class="back-button"
                       th:attr="aria-label=${isOwner ? 'Kembali ke halaman Resep Saya' : 'Kembali ke halaman Jelajahi'}">
                        <span class="button-icon">‚¨ÖÔ∏è</span>
                        <span th:text="${isOwner ? 'Kembali ke Resep Saya' : 'Kembali ke Jelajahi'}">Back</span>
                    </a>
                </nav>
            </article>
        </main>
    </div>

    <a href="#main-content" class="skip-link">Skip to main content</a>

    <style>
        /* Additional CSS for improved accessibility and UX */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #000;
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 1000;
        }

        .skip-link:focus {
            top: 6px;
        }

        .recipe-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .meta-label {
            font-weight: normal;
            color: #666;
        }

        .button-icon {
            margin-right: 0.5rem;
        }

        .sidebar-icon {
            margin-right: 0.5rem;
        }

        /* --- REMOVED: .ingredient-item, .instruction-item, .step-number as they are no longer used with <pre> --- */
        /*
        .ingredient-item,
        .instruction-item {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .step-number {
            font-weight: bold;
            margin-right: 0.5rem;
            color: #007bff;
        }
        */

        .owner-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .delete-form {
            display: inline;
        }

        /* NEW CSS FOR <pre> TAG */
        .recipe-pre-format {
            background-color: #f8f8f8; /* Light background to visually distinguish */
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            white-space: pre-wrap; /* Crucial: Preserves newlines and spaces, but allows wrapping */
            word-wrap: break-word; /* Helps with very long words */
            font-family: inherit; /* Inherit font from parent, not monospace default */
            font-size: 1.05em; /* Slightly larger font for readability */
            line-height: 1.8; /* Good spacing between lines */
            color: #444; /* Darker text color */
        }


        @media (max-width: 768px) {
            .recipe-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .owner-actions {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>